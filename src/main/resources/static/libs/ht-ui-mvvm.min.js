var mvvm=function(t,e){"use strict";function i(t){var e=navigator.userAgent;return"ie"===t?!!(e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1)&&(new RegExp("MSIE (\\d+\\.\\d+);").test(e),parseFloat(RegExp.$1)):e.indexOf(t)>-1}e=e&&e.hasOwnProperty("default")?e.default:e,ht.ui.View.prototype.setLayoutWidth=function(t){var e=this.getLayoutParams()||{};e.width=t,this.setLayoutParams(e)},ht.ui.View.prototype.setLayoutHeight=function(t){var e=this.getLayoutParams()||{};e.height=t,this.setLayoutParams(e)},ht.ui.View.prototype.setMatchParent=function(){var t=this.getLayoutParams()||{};t.width="match_parent",t.height="match_parent",this.setLayoutParams(t)},ht.ui.View.prototype.setMatchParentWidth=function(){var t=this.getLayoutParams()||{};t.width="match_parent",this.setLayoutParams(t)},ht.ui.View.prototype.setMatchParentHeight=function(){var t=this.getLayoutParams()||{};t.height="match_parent",this.setLayoutParams(t)},ht.ui.View.prototype.setWrapContent=function(){var t=this.getLayoutParams()||{};t.width="wrap_content",t.height="wrap_content",this.setLayoutParams(t)},ht.ui.View.prototype.setWrapContentWidth=function(){var t=this.getLayoutParams()||{};t.width="wrap_content",this.setLayoutParams(t)},ht.ui.View.prototype.setWrapContentHeight=function(){var t=this.getLayoutParams()||{};t.height="wrap_content",this.setLayoutParams(t)},ht.ui.BorderLayout.prototype.removeChildByRegion=function(t){var e=this.getChildByRegion(t);e&&this.removeView(e)},ht.ui.BorderLayout.prototype.setTopContent=function(t,e){this.removeChildByRegion("top"),null!==t&&((e=e||t.getLayoutParams()||{width:"match_parent"}).region="top",this.addView(t,e))},ht.ui.BorderLayout.prototype.setLeftContent=function(t,e){this.removeChildByRegion("left"),null!==t&&((e=e||t.getLayoutParams()||{height:"match_parent"}).region="left",this.addView(t,e))},ht.ui.BorderLayout.prototype.setRightContent=function(t,e){this.removeChildByRegion("right"),null!==t&&((e=e||t.getLayoutParams()||{height:"match_parent"}).region="right",this.addView(t,e))},ht.ui.BorderLayout.prototype.setBottomContent=function(t,e){this.removeChildByRegion("bottom"),null!==t&&((e=e||t.getLayoutParams()||{height:"match_parent"}).region="bottom",this.addView(t,e))},ht.ui.BorderLayout.prototype.setCenterContent=function(t,e){this.removeChildByRegion("center"),null!==t&&((e=e||t.getLayoutParams()||{}).region="center",this.addView(t,e))},ht.ui.BorderLayout.prototype.getTopContent=function(){return this.getChildByRegion("top")},ht.ui.BorderLayout.prototype.getLeftContent=function(){return this.getChildByRegion("left")},ht.ui.BorderLayout.prototype.getRightContent=function(){return this.getChildByRegion("right")},ht.ui.BorderLayout.prototype.getBottomContent=function(){return this.getChildByRegion("bottom")},ht.ui.BorderLayout.prototype.getCenterContent=function(){return this.getChildByRegion("center")};var n={_isIE11:function(){var t=0,e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),i=!!navigator.userAgent.match(/Trident\/7.0/),n=navigator.userAgent.indexOf("rv:11.0");return e&&(t=Number(RegExp.$1)),-1!==navigator.appVersion.indexOf("MSIE 10")&&(t=10),i&&-1!==n&&(t=11),11===t},_isEdge:function(){return/Edge/.test(navigator.userAgent)},_getDownloadUrl:function(t){if(window.Blob&&window.URL&&window.URL.createObjectURL){var e=new Blob(["\ufeff"+t],{type:"text/csv"});return URL.createObjectURL(e)}return"data:attachment/csv;charset=utf-8,\ufeff"+encodeURIComponent(t)},download:function(t,e){if(i("ie")&&i("ie")<10){var n=window.top.open("about:blank","_blank");n.document.charset="utf-8",n.document.write(e),n.document.close(),n.document.execCommand("SaveAs",t),n.close()}else if(10===i("ie")||this._isIE11()||this._isEdge()){var a=new Blob(["\ufeff"+e],{type:"text/csv"});navigator.msSaveBlob(a,t)}else{var o=document.createElement("a");o.download=t,o.href=this._getDownloadUrl(e),document.body.appendChild(o),o.click(),document.body.removeChild(o)}}};ht.ui.TableView.prototype.animateAdd=function(t){var e=this;e.getDataModel().add(t,0),t._rowHeight=0;var i=40,n=0,a=e.drawData;e.drawData=function(o,r,u,s,l){t===r&&(o.translate(i,0),o.globalAlpha=n),a.call(e,o,r,u,s,l),t===r&&(o.globalAlpha=1,o.translate(-i,0))},ht.Default.startAnim({frames:30,finishFunc:function(){ht.Default.startAnim({frames:30,finishFunc:function(){e.drawData=a},action:function(t,a){i=40*(1-a),n=.1+.9*a,e.iv()}})},action:function(i,a){t._rowHeight=40*a,n=.1*a,e.iv()}})},ht.ui.GridPane&&(ht.ui.GridPane.prototype.exportCsv=function(t){this.getTableView().exportCsv(t)}),ht.ui.TablePane.prototype.exportCsv=function(t){this.getTableView().exportCsv(t)},ht.ui.TreeTablePane.prototype.exportCsv=function(t){this.getTableView().exportCsv(t)},ht.ui.TreeTableView.prototype.exportCsv=ht.ui.TableView.prototype.exportCsv=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"未命名",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[],o=[],r=[],u={};if(this instanceof ht.ui.TreeTableView){var s=this.getTreeColumn();r.push(s.getDisplayName()?s.getDisplayName():s.getName()),a.push("name")}i||(this.getColumnModel().each(function(t){if(t.getName()&&!(t instanceof ht.ui.GroupColumn)){var e="";t.getParent()&&t.getParent()instanceof ht.ui.GroupColumn&&(e=t.getParent().getName()),r.push(e+(t.getDisplayName()?t.getDisplayName():t.getName())),a.push(t.getName()),u[t.getName()]=t}}),r.length>0&&o.push(r.join(e))),this.getDataModel().each(function(t){var i=t.getAttrObject();o.push(a.map(function(e){if(void 0!==i[e]){var n=i[e];return u[e]&&"function"==typeof u[e].formatValue?u[e].formatValue(n,t):i[e]}return""}).join(e))}),n.download(t,o.join("\r\n"))},ht.ui.GridPane&&(ht.ui.GridPane.prototype.importCsv=function(){return this.getTableView().importCsv()}),ht.ui.TablePane.prototype.importCsv=function(){return this.getTableView().importCsv()},ht.ui.TableView.prototype.importCsv=function(){var t=this,e=document.createElement("input");return e.type="file",e.accept=".csv",e.style.display="none",document.body.appendChild(e),new Promise(function(i,n){e.addEventListener("change",function(){var n=e.files[0];if(n.size>1048576)App.toast("文件大小不可超过1M");else{var a=new FileReader;a.onload=function(e){var n=e.currentTarget.result;if("string"==typeof n){var a=n.split("\r\n"),o=a[0].split(",");a=a.slice(1);var r=[],u=t.getColumnModel();o.forEach(function(t,e){var i=!1;u.each(function(e){e.getDisplayName()===t&&(r.push(e),i=!0)}),i||r.push(null)});var s=[];a.forEach(function(t){var e=t.split(","),i=new ht.Data;e.forEach(function(t,e){if(t&&""!==t){var n=r[e];if(null===n)return;var a=n.getName(),o=n.getValueType();"int"===o||"number"===o?i.a(a,Number(t)):"boolean"===o?i.a(a,""!==t&&"false"!==t&&"0"!==t):i.a(a,t)}}),s.push(i)}),i(s)}},a.readAsText(n)}}),e.click()})},ht.ui.TableView.prototype.scrollToData=function(t){this.scrollToIndex(this.getRowIndex(t))},ht.Math.Quaternion&&(ht.graph3d.Graph3dView.prototype.lookAtX=function(){var t=new ht.Math.Quaternion,e=new ht.Math.Vector3,i=new ht.Math.Vector3,n=new ht.Math.Vector3;return function(a,o,r){var u=function(a,o,r,u){var s;return o?(t.setFromEuler(o.r3(),o.getRotationMode()),s=o.p3()):(t.set(0,0,0,1),s=a.getCenter()),u||(i.fromArray(a.getEye()),n.fromArray(a.getCenter()),u=i.sub(n).length()),e.fromArray(r).applyQuaternion(t).setLength(u),[s[0]+e.x,s[1]+e.y,s[2]+e.z]}(this,a,o,r);a&&this.setCenter(a.p3()),this.setEye(u)}}()),ht.graph3d.Graph3dView.prototype.lookAtTop=function(t,e){this.lookAtX(t,[0,1,0],e)},ht.graph3d.Graph3dView.prototype.lookAtRight=function(t,e){this.lookAtX(t,[1,0,0],e)},ht.graph3d.Graph3dView.prototype.lookAtBottom=function(t,e){this.lookAtX(t,[0,-1,0],e)},ht.graph3d.Graph3dView.prototype.lookAtLeft=function(t,e){this.lookAtX(t,[-1,0,0],e)},ht.graph3d.Graph3dView.prototype.lookAtFront=function(t,e){this.lookAtX(t,[0,0,1],e)},ht.graph3d.Graph3dView.prototype.lookAtBack=function(t,e){this.lookAtX(t,[0,0,-1],e)};var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function t(e,i,n){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,i);if(void 0===a){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in a)return a.value;var r=a.get;return void 0!==r?r.call(n):void 0},s=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},h=function(t){function e(){o(this,e);var t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.radios=new ht.ui.Radios,t}return s(e,t),r(e,[{key:"setFormDataName",value:function(t){this.formDataName=t,this.getChildren().each(function(e){e.setFormDataName(t)})}},{key:"getFormDataName",value:function(){return this.formDataName}},{key:"getRadios",value:function(){return this.radios}},{key:"setDatas",value:function(t){var e=this;this.clear(),Array.isArray(t)&&t.forEach(function(t){var i=ht.ui.dsl.radiobutton(t);i.setRadios(e.radios),i.setFormDataName(e.formDataName),e.addView(i,{vAlign:"middle",height:"match_parent",marginRight:6})})}}]),e}(ht.ui.HBoxLayout);ht.ui.HBoxRadioGroup=h;var c=ht.ui.Sidebar||ht.ui.View,d=function(t){function e(){o(this,e);var t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,new ht.DataModel));t.setCollapsedMode(!1),t.setPopupSeparatorColor("rgba(0,0,0,0)");var i=t.getDataModel();return i.sm().setSelectionMode("single"),t.getAccordionTree().on("expand",function(e){var n=e.data;i.getRoots().each(function(e){e!==n&&t.getAccordionTree().collapse(e)})}),t}return s(e,c),r(e,[{key:"linkBorderlayout",value:function(t){var e=this,i=t.drawToggle;t.drawToggle=function(n,a,o,r,u,s){if("left"===s&&e.isCollapsedMode()){if(n){var l=t,h=l.getSplitterCanvas(s),c=l.getRootContext(h),d=r/2,f=u/2,p=a+d,g=o+f;c.save(),c.translate(p,g),c.rotate(Math.PI/2),n.draw(-f,-d,u,r,null,l,h),c.restore()}}else i.call(t,n,a,o,r,u,s)};var n=t.isLeftResizable;t.isLeftResizable=function(){return!e.isCollapsedMode()&&n.call(t)},t.toggleLeftExpanded=function(){e.isCollapsedMode()?(t.setLeftWidth(200),e.setCollapsedMode(!1)):(t.setLeftWidth(50),e.setCollapsedMode(!0))}}},{key:"onSelectionChanged",value:function(t){var e=this.getDataModel();e.sm().addSelectionChangeListener(function(){return t(e.sm().ld())})}},{key:"selectByTag",value:function(t){var e=this.getDataModel();e.sm().cs(),e.sm().ss(e.getDataByTag(t))}},{key:"appendChildren",value:function(t,e,i){var n=this;Array.isArray(i)&&i.forEach(function(i){if("function"==typeof i.visible){if(!i.visible())return}else if(!1===i.visible)return;if("function"!=typeof n.isItemVisible||n.isItemVisible(i)){var a=new ht.Data;Object.assign(a,i),a.setName(i.name),a.setIcon(i.icon),a.s("icon",i.icon),a.s("labelColor",i.labelColor),a.a(i),e&&(e.addChild(a),a.setParent(e)),i.tag?a.setTag(i.tag):a.setTag(i.name),t.add(a),n.appendChildren(t,a,i.children)}})}},{key:"loadJson",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.getDataModel();return e&&i.clear(),this.appendChildren(i,null,t),i}}]),e}();ht.ui.NavBar=d;var f=function(t){function e(t){o(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=i.eChartDiv=document.createElement("div");if(n.style.width="100%",n.style.height="100%",i.setContent(n),i.theme=window.echartTheme?window.echartTheme:"shine",i._echart=echarts.init(n,i.theme),t){i.addViewListener(function e(n){"endValidate"===n.kind&&(ht.Default.callLater(function(){i.setOption(t)}),i.removeViewListener(e))})}return i.addPropertyChangeListener(function(t){var e=t.property;"width"!==e&&"height"!==e||(i._resizeEChart=!0)}),i}return s(e,t),r(e,[{key:"recreate",value:function(t){this._echart&&!this._echart.isDisposed()&&this._echart.dispose(),this._echart=echarts.init(this.eChartDiv,this.theme),this.setOption(t)}},{key:"setTheme",value:function(t){this.theme=t,this._echart&&!this._echart.isDisposed()&&this._echart.dispose(),this._echart=echarts.init(this.eChartDiv,t),this._option&&this._echart.setOption(this._option)}},{key:"setOption",value:function(t){this._option=t,this.setPropertyValue("option",t),this._echart.setOption(t)}},{key:"getOption",value:function(){return this._option}},{key:"validateImpl",value:function(t,i,n,a){var o=this._echart;u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"validateImpl",this).call(this,t,i,n,a),this._resizeEChart&&(o.resize(),delete this._resizeEChart)}},{key:"getSerializableProperties",value:function(){var t=u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getSerializableProperties",this).call(this);return ht.Default.addMethod(t,{option:!0})}}]),e}(ht.ui.HtmlView);ht.ui.EChartView=f;var p=function(t){function e(){return o(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return s(e,t),r(e,[{key:"setColumns",value:function(t){this.columns=t}},{key:"initDropDownView",value:function(t,e,i){var n=this;this.master=t;var a=this.tablePane=ht.ui.dsl.tablepane({style:"dropdownTablePane",columns:t.getDropDownConfig().columns}),o=a.getDataModel();return e&&e.forEach(function(e){var n=new ht.Data;n.a(e),o.add(n),i&&(t.getValueField()&&e[t.getValueField()]===i?o.sm().as(n):i===e&&o.sm().as(n))}),a.setPreferredSize(400,300),o.sm().ms(function(){n.stop()}),a}},{key:"getDropDownValue",value:function(){var t=this.tablePane.getDataModel().sm().ld();return t?this.master.getValueField()?t.a(this.master.getValueField()):t.getAttrObject():null}},{key:"afterOpen",value:function(t){this.getDropDownView().validate()}}]),e}(ht.ui.DropDownTemplate);ht.ui.TableDropDownTemplate=p;var g=function(t){function e(){return o(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return s(e,t),r(e,[{key:"setSrc",value:function(t){this.setPropertyValue("src",t),this._iframeEl=function(t){var e=document.createElement("iframe");return e.setAttribute("style","width: 100%; height: 100%; margin: 0; padding: 0; border: 0;"),e.border=0,e.src=t,e}(t),this.setContent(this._iframeEl)}},{key:"getSrc",value:function(){return this.getPropertyValue()}}]),e}(ht.ui.HtmlView);ht.ui.IFrameView=g;var v=function(t){function e(){o(this,e);var t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),i=t.img=document.createElement("img");return i.setAttribute("style","width:100%;height 100%;"),t.setContent(i),t}return s(e,t),r(e,[{key:"setSrc",value:function(t){this.setPropertyValue("src",t),t?(this.img.src=t,this.img.style.display="block"):this.img.style.display="none"}}]),e}(ht.ui.HtmlView);ht.ui.ImageView=v;var y=function(t){function e(){o(this,e);var t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.setStyle("pageHeader"),t}return s(e,t),r(e,[{key:"getChildLayoutParams",value:function(t){var e=ht.Default.clone(t.getLayoutParams()||{});return e.vAlign||(e.vAlign="middle"),e}}]),e}(ht.ui.HBoxLayout);ht.ui.PageHeader=y;var m=function(t){function e(){o(this,e);var t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.autoFitContent=!0,t.displayPadding=20,t.initGV(),t.setContent(t.graphView),t.on("endValidate",function(){t.autoFitContent&&ht.Default.callLater(function(){t.graphView.fitContent(!1,t.displayPadding)})}),t}return s(e,t),r(e,[{key:"setDisplayPadding",value:function(t){this.displayPadding=t}},{key:"initGV",value:function(){var t=this,e=this.graphView=new ht.graph.GraphView;window.graphView=e,this.dataModel=e.dm(),this.dataModel.mm(function(e){"clear"===e.kind&&t.fireViewEvent("unload")}),e.setMovableFunc(function(){return!1}),e.mi(function(i){"doubleClickBackground"===i.kind&&t.autoFitContent&&e.fitContent(!0,t.displayPadding)})}},{key:"getGraphView",value:function(){return this.graphView}},{key:"gv",value:function(){return this.graphView}},{key:"setAutoFitContent",value:function(t){this.autoFitContent=t}},{key:"isAutoFitContent",value:function(){return this.autoFitContent}},{key:"setDisplayUrl",value:function(t,e){this.load(t,e)}},{key:"xhrLoad",value:function(t){return new Promise(function(e,i){ht.Default.xhrLoad(t,function(t){e(t)})})}},{key:"load",value:function(t,e){var i=this;if(t!==this.displayUrl){if(t){this.displayUrl=t,this.sourceData=e,this.gv().getDataModel().clear();var n=new ht.DataModel;return this.dataModel=n,this.dataModel.mm(function(t){"clear"===t.kind&&i.fireViewEvent("unload")}),this.graphView.setDataModel(n),new Promise(function(e){i.xhrLoad(t).then(function(a){if(a){var o=ht.Default.parse(a);n.deserialize(o),i.autoFitContent&&i.graphView.fitContent(!1,i.displayPadding),i.fireViewEvent("load"),e()}else console.warn("无法加载图纸：",t)})})}console.warn("未选择图纸")}}}]),e}(ht.ui.HTView);ht.ui.DisplayView=m;var w=function(t){function e(){o(this,e);var t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),i=t.g3d=new ht.graph3d.Graph3dView;return t.setContent(i),t.dataModel=i.dm(),i.enableToolTip(),i.setMovableFunc(function(){return!1}),t}return s(e,t),r(e,[{key:"gv",value:function(){return this.g3d}},{key:"xhrLoad",value:function(t){return new Promise(function(e,i){ht.Default.xhrLoad(t,function(t){e(t)})})}},{key:"load",value:function(t){var e=this;return new Promise(function(i){e.xhrLoad(t).then(function(t){var n=ht.Default.parse(t);e.g3d.getDataModel().deserialize(n),e.fireViewEvent("load"),i()})})}},{key:"setSceneUrl",value:function(t){this.load(t)}}]),e}(ht.ui.HTView);function b(t){if("string"==typeof t)return new ht.ui.drawable.FontIconDrawable(t);var e=t.unicode,i=t.color,n=void 0===i?"#000":i,a=t.fontName,o=void 0===a?"FontAwesome":a;return new ht.ui.drawable.FontIconDrawable(e,n,o)}ht.ui.SceneView=w;var _=function(t){function e(){o(this,e);var t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.setPadding(0),t.setBorder(null),t.setIconWidth(22),t.setIconHeight(22),t.setBackground(null),t.setHoverBackground(null),t.setActiveBackground(null),t}return s(e,t),r(e,[{key:"setFontIcon",value:function(t){this.setIconDrawable(b(t))}},{key:"setHoverFontIcon",value:function(t){this.setHoverIconDrawable(b(t))}},{key:"setActiveFontIcon",value:function(t){this.setActiveIconDrawable(b(t))}}]),e}(ht.ui.Button);ht.ui.FontIconButton=_,ht.ui.tablefilter&&(ht.ui.tablefilter.TextFilter=function(){ht.ui.tablefilter.TextFilter.superClass.constructor.call(this)},ht.Default.def("ht.ui.tablefilter.TextFilter",ht.ui.tablefilter.Filter,{_filter:function(t,e,i){if(!i)return!0;var n=ht.Default.getPropertyValue(t,e.getAccessType(),e.getName());return!!(n&&String(n).toLowerCase().indexOf(i.toLowerCase())>=0)||void 0},initFilterView:function(t,e){var i=this,n=new ht.ui.TextField,a=t.getTableView();return n.setInstant(!0),n.addPropertyChangeListener(function(t){"value"===t.property&&i.setFilterFunc(function(n){return a instanceof ht.ui.TreeTableView?i.recursion(i._filter,n,e,t.newValue):i._filter(n,e,t.newValue)})}),n},clearFilterValue:function(){this.getFilterView().setValue("")}})),ht.ui.tablefilter&&(ht.ui.tablefilter.EnumFilter=function(){ht.ui.tablefilter.EnumFilter.superClass.constructor.call(this)},ht.Default.def("ht.ui.tablefilter.EnumFilter",ht.ui.tablefilter.Filter,{_filter:function(t,e,i){if("object"===(void 0===i?"undefined":a(i))){if(!i.id)return!0}else if(""===i)return!0;var n=ht.Default.getPropertyValue(t,e.getAccessType(),e.getName());return"object"!==(void 0===i?"undefined":a(i))?i===n:n===i.id||n===i.value||void 0},initFilterView:function(t,e){var i=this,n=new ht.ui.ComboBox,a=e.a("filterConfig"),o=t.getTableView();for(var r in n.setReadOnly(!0),n.setDatas(e.getDatas()),a)n[ht.Default.setter(r)](a[r]);return n.addPropertyChangeListener(function(t){"value"===t.property&&i.setFilterFunc(function(n){return o instanceof ht.ui.TreeTableView?i.recursion(i._filter,n,e,t.newValue):i._filter(n,e,t.newValue)})}),n}})),ht.ui.tablefilter&&(ht.ui.tablefilter.ComboBoxFilter=function(){ht.ui.tablefilter.ComboBoxFilter.superClass.constructor.call(this)},ht.Default.def("ht.ui.tablefilter.ComboBoxFilter",ht.ui.tablefilter.Filter,{_filter:function(t,e,i){if(-1===i.id)return!0;var n=ht.Default.getPropertyValue(t,e.getAccessType(),e.getName());return n===i.id||n==i.value||void 0},initFilterView:function(t,e){var i=this,n=this.comboBox,a=t.getTableView();return n.addPropertyChangeListener(function(t){"value"===t.property&&i.setFilterFunc(function(n){return a instanceof ht.ui.TreeTableView?i.recursion(i._filter,n,e,t.newValue):i._filter(n,e,t.newValue)})}),n}}));var C=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#1890ff";o(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.activeColor=t,i}return s(e,t),r(e,[{key:"setActiveColor",value:function(t){this.activeColor=t}},{key:"draw",value:function(t,e,i,n,a,o,r){var u=o.getRootContext(r);u.beginPath(),u.rect(t,e+n-2,i,2),u.fillStyle=this.activeColor,u.fill()}}]),e}(ht.ui.drawable.Drawable);ht.ui.drawable.TabActiveBackgroundDrawable=C,ht.ui.drawable.SplitterLineDrawable=function(t,e){ht.ui.drawable.SplitterLineDrawable.superClass.constructor.call(this),t&&this.setWidth(t),e&&this.setColor(e)},ht.Default.def(ht.ui.drawable.SplitterLineDrawable,ht.ui.drawable.Drawable,{ms_ac:["width","color"],draw:function(t,e,i,n,a,o,r){var u=o.getRootContext(r),s=this.getColor(),l=this.getWidth();"top"===a?(u.beginPath(),u.rect(t,e+(n-l)/2,i,l),u.fillStyle=s,u.fill()):"left"===a&&(u.beginPath(),u.rect(t+(i-l)/2,e,l,n),u.fillStyle=s,u.fill())}});var V=function t(e,i,n){t.superClass.constructor.call(this),this.setBackground(e),this.setColor(i),this.setWidth(n)};function D(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.sqrt(t*t+e*e+i*i)}ht.Default.def(V,ht.ui.drawable.Drawable,{ms_ac:["background","color","width"],draw:function(t,e,i,n,a,o,r){var u=o.getRootContext(r),s=this.getBackground(),l=this.getColor();u.beginPath(),u.fillStyle=l,u.rect(t,e,this.getWidth(),n),u.fill(),u.beginPath(),u.fillStyle=s,u.rect(this.getWidth(),e,t+i,n),u.fill()},getSerializableProperties:function(){var t=V.superClass.getSerializableProperties.call(this);return ht.Default.addMethod(t,{background:1,color:1,width:1})}}),ht.ui.drawable.TreeHoverBackgroundDrawable=V,ht.ui.drawable.GradientDrawable=function(t,e){ht.ui.drawable.GradientDrawable.superClass.constructor.call(this),null!=t&&this.setColor1(t),null!=e&&this.setColor2(e)},ht.Default.def("ht.ui.drawable.GradientDrawable",ht.ui.drawable.Drawable,{ms_ac:["color1","color2"],draw:function(t,e,i,n,a,o,r){var u=o.getRootContext(r),s=this.getColor1(),l=this.getColor2();u.beginPath();var h=u.createLinearGradient(t,e,t,e+n);h.addColorStop(0,s),h.addColorStop(1,l),u.rect(t,e,i,n),u.fillStyle=h,u.fill()},getSerializableProperties:function(){var t=ht.ui.drawable.GradientDrawable.superClass.getSerializableProperties.call(this);return ht.Default.addMethod(t,{color1:1,color2:1})}}),ht.ui.drawable.FontIconDrawable=function(t,e,i){ht.ui.drawable.ImageDrawable.superClass.constructor.call(this),this.setText(t),this.setColor(e),i||(i="FontAwesome"),this.setFontName(i)},ht.Default.def("ht.ui.drawable.FontIconDrawable",ht.ui.drawable.Drawable,{ms_ac:["text","color","fontName"],doesFontExist:function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=this.getText(),n=this.getFontName();e.font="72px monospace";var a=e.measureText(i).width;return e.font="72px '"+n+"', monospace",t=null,e.measureText(i).width!=a},draw:function(t,e,i,n,a,o,r){var u=this,s=o.getRootContext(r),l=u.getText(),h=u.getColor(),c=u.getFontName();ht._fontloaded?(s.beginPath(),ht.Default.drawText(s,l,Math.round(Math.max(i,n))+"px "+c,h,t,e,i,n,"center","middle")):(ht._useFontViews||(ht._timer=setInterval(function(){u.doesFontExist()?(ht._useFontViews.forEach(function(t){t.iv()}),clearInterval(ht._timer),ht._timer=null,ht._useFontViews=null,ht._timercounter=null,ht._fontloaded=!0):(ht._timercounter++,ht._timercounter>20&&(clearInterval(ht._timer),ht._timer=null,ht._useFontViews=null,ht._timercounter=null,ht._fontloaded=!0))},1e3),ht._timercounter=0,ht._useFontViews=[]),ht._useFontViews.indexOf(o)<0&&ht._useFontViews.push(o))},getSerializableProperties:function(){var t=ht.ui.drawable.FontIconDrawable.superClass.getSerializableProperties.call(this);return ht.Default.addMethod(t,{text:1,color:1})}});var P=500,k=1.4*P,F=function(t){function e(t,i){o(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));n.setFar(1e7),n.setMovableFunc(function(){return!1});var a=n.earth=new ht.Node;a.s3(2*P,2*P,2*P),a.s({"3d.selectable":!1,shape3d:"sphere","shape3d.side":80,"shape3d.resolution":50}),t&&a.s("shape3d.image",t);var r=n.light=new ht.Node;return r.p3(0,0,0),r.s3(1861,1800,1),r.s({alphaTest:0,"3d.selectable":!1,shape3d:"billboard","shape3d.transparent":!0,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!0}),i&&r.s("shape3d.image","assets/background/light.png"),n.mp(function(t){if("eye"===t.property){var e=n.getEye(),i=a.p3(),o=D(e[0]-i[0],e[1]-i[1],e[2]-i[2]);if(o<k){var r=k/o;n.setEye([e[0]*r+i[0],e[1]*r+i[1],e[2]*r+i[2]])}else n.updateLight(e,i)}}),n.updateLight(n.getEye(),a.p3()),n.dm().add(a),n.dm().add(r),n}return s(e,t),r(e,[{key:"updateLight",value:function(t,e){var i=1/function(t,e,i){var n=D(t[0]-e[0],t[2]-e[2],t[1]-e[1]);if(n<=i)return 0;var a=i/n;return Math.sqrt(1-a*a)}(t,e,P);this.light.setScale3d(i,i,i)}},{key:"setLightImage",value:function(t){this.light.s("shape3d.image",t)}},{key:"setGlobalImage",value:function(t){this.earth.s("shape3d.image",t)}},{key:"addNode",value:function(t,e,i){var n=new ht.Node;return n.p3(function(t,e){var i=parseFloat(t[0])/180*Math.PI,n=parseFloat(t[1])/180*Math.PI,a=Math.sin(i),o=Math.cos(i),r=Math.sin(n);return[-e*o*Math.cos(n),e*a,e*o*r]}(t,P)),n.s({"3d.movable":!1,shape3d:"billboard","shape3d.image":i,"shape3d.image.cache":!1,"shape3d.vector.dynamic":!0,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!0}),n.setAnchor3d(.38,.5,.5),n.s3([e.width,e.height,1]),n.setScale3d(.6,.6,.6),this.dm().add(n),n}}]),e}(ht.graph3d.Graph3dView);ht.graph3d.GlobalView=F;var L=function(){function t(e){o(this,t),this.data=e}return r(t,[{key:"init",value:function(t){this.config=Object.assign({duration:1e3,autoReverse:!1,reverse:!1,repeat:!1,easing:function(t){return t},onUpdate:function(){}},t||{})}},{key:"$run",value:function(){var t=this,e=this.config;this.animat=ht.Default.startAnim({duration:e.duration,easing:e.easing,frames:e.frames,interval:e.interval,finishFunc:function(){if(!t.data.dm())return t.running=!1,void(t.animat=null);e.repeat&&t.data.dm()&&t.running?(e.autoReverse&&(e.reverse=!e.reverse),t.$run(e)):e.onFinished&&e.onFinished()},action:function(t,i){e.reverse&&(t=1-t),e.onUpdate&&e.onUpdate(t,i)}})}},{key:"start",value:function(){this.animat?this.animat.resume():(this.running=!0,this.$run())}},{key:"stop",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.running=!1,this.animat&&this.animat.stop(t),this.animat=null}},{key:"pause",value:function(){this.animat&&this.animat.pause()}},{key:"resume",value:function(){this.animat&&this.animat.resume()}}]),t}();ht.Data.prototype.startAnimat=function(t){var e=new L(this);return e.init(t),e.start(),e},ht.ui.Button.prototype.onClick=function(t){this.on("click",t)},ht.ui.RadioButton.prototype.onSelectChanged=function(t){this.on("p:selected",t)},ht.ui.Dialog.prototype.setAutoSize=function(t){var e=this;this.autoSizeListener&&this.off("invalidatePreferredSize",this.autoSizeListener),t&&(this.autoSizeListener=function(){ht.Default.callLater(function(){var t=e.getPreferredSize();e.setWidth(t.width),e.setHeight(t.height)})},this.on("invalidatePreferredSize",this.autoSizeListener))},ht.ui.TableLayout.prototype.setColumns=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e],n=i.width,a=i.weight;n&&this.setColumnPreferredWidth(e,n),void 0!==a&&this.setColumnWeight(e,a)}},ht.ui.Column.prototype.setFilterClass=function(t){this.a("filterClass",t)},ht.ui.ComboBox.prototype.selectFirst=function(){var t=this.getDatas();if(Array.isArray(t)&&t.length>0){var e=this.getValueField();e?this.setValue(t[0][e]):this.setValue(t[0])}},ht.ui.HButtonGroup.prototype.setDatas=function(t){var e=this;this.clear(),Array.isArray(t)&&t.forEach(function(t){var i=ht.ui.dsl.togglebutton(t);e.addView(i)})},ht.ui.VButtonGroup.prototype.setDatas=function(t){var e=this;this.clear(),Array.isArray(t)&&t.forEach(function(t){var i=ht.ui.dsl.togglebutton(t);e.addView(i)})},ht.ui.Form.prototype.bind=function(t,e){t.$bindForm(e,this)};var T=window.localStorage.getItem("locale");T||(T="zh-CN");var M={},O={locale:T,messages:M,install:function(t,e){this.messages[t]=e},t:function(t){var e=M[this.locale];return e&&e[t]||t}},x=new e,A=function(){function t(e){o(this,t),e=e||{},Object.assign(this,e.data),Object.defineProperty(this,"__watchers",{value:[],enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"__binders",{value:[],enumerable:!1,writable:!0,configurable:!0}),this._initComputed(e.computed),this._initWatch(e.watch)}return r(t,[{key:"$destroy",value:function(){this.__watchers.forEach(function(t){ht.Default.unwatchObject(t)}),this.__binders.forEach(function(t){ht.Default.unbind(t)})}},{key:"$watch",value:function(t,e){var i=ht.Default.watchObject(this,t,e);return this.__watchers.push(i),i}},{key:"$bindForm",value:function(t,e){var i=this.$getVal(t);if(i){var n=ht.Default.bindForm(i,e);this.__binders=this.__binders.concat(n)}else console.log("can not found form data to bind:",t)}},{key:"$bind",value:function(t,e,i,n,a){var o=ht.Default.bind({data:this,property:i},{data:t,property:e,getValue:function(t){var i=ht.Default.getter(e),n=null;return n="function"==typeof t[i]?t[i].call(t):"function"==typeof t[e]?t[e]():t[e],a&&"function"==typeof a.toModelValue&&(n=a.toModelValue(n)),n},setValue:function(t,i,n,o){a&&"function"==typeof a.toViewValue&&(o=a.toViewValue(o));var r=ht.Default.setter(e);"function"==typeof t[r]?t[r](o):"function"==typeof t[e]?t[e](o):t[e]=o}},n);this.__binders.push(o)}},{key:"$setVal",value:function(t,e){var i=this;(t=t.split(".")).forEach(function(n,a){a<t.length-1?i=i[n]:i[n]=e})}},{key:"$getVal",value:function(t){var e=this;return(t=t.split(".")).forEach(function(t){if(void 0===(e=e[t]))return null}),e}},{key:"_initComputed",value:function(t){var e=this;"object"===(void 0===t?"undefined":a(t))&&Object.keys(t).forEach(function(i){Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:"function"==typeof t[i]?t[i]:t[i].get,set:t[i].set||function(){}})})}},{key:"_initWatch",value:function(t){var e=this;"object"===(void 0===t?"undefined":a(t))&&Object.keys(t).forEach(function(i){var n=ht.Default.watchObject(e,i,t[i]);e.__watchers.push(n)})}}]),t}();window.ViewModel=A;var B=function(){function t(e,i){o(this,t),this.i18n=O,this.eventbus=x,this.viewModel=null,i&&this.createViewModel(i),this.messages=e,this.root=null,this._views={}}return r(t,[{key:"createViewModel",value:function(t){return this.viewModel=new A(t),this.viewModel}},{key:"getRoot",value:function(){return this.root}},{key:"getView",value:function(){return this.root}},{key:"getViewModel",value:function(){return this.viewModel}},{key:"vm",value:function(){return this.viewModel}},{key:"bind",value:function(t,e,i){return new ht.ui.dsl.Bind(this.viewModel,t,e,i)}},{key:"lookup",value:function(t){return this.getViewById(t)}},{key:"getViewById",value:function(t){if(this._views[t])return this._views[t];var e=this.root.findViewById(t,!0);return e?(this._views[t]=e,e):null}},{key:"t",value:function(t){if(this.messages){var e=this.messages[O.locale];if(e)return e[t]||O.t(t)}return O.t(t)}}]),t}();return B.eventbus=x,ht.ui.mvvm=ht.ui.mvvm||{},ht.ui.mvvm.View=B,window.ModelView=B,t.i18n=O,t.eventbus=x,t.ModelView=B,t.ViewModel=A,t.default=B,t}({},EventEmitter);
