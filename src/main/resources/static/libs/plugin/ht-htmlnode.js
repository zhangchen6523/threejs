!function(m){"use strict";var h="ht",A=m[h],G=function(){return document},e=function(){return G().body},z=function(q,H,m){q.style.setProperty(H,m,null)},q=function(F){return G().createElement(F)},n=function(){return q("div")},S=function(){var H=q("canvas");return H},c=function(w,p){z(w,"-webkit-transform",p),z(w,"-ms-transform",p),z(w,"transform",p)},D=function(U,l){z(U,"-webkit-transform-origin",l),z(U,"-ms-transform-origin",l),z(U,"transform-origin",l)},y=function(U,K){U.appendChild(K)},Q=function(P,n){P.removeChild(n)},U=m.parseInt,p=A.Default,a=p.eventListenerOptionsFalse,W=(p.eventListenerOptionsTrue,function(n,y,V,M){n.addEventListener(y,V,M?a:a)}),g=p.getInternal(),u=Math.PI,x="white-space",I="visibility",r="left",P="top",t="width",s="height",w="position",K="display",$="z-index",Z="px",Y="0 0",l="absolute",F="visible",v="hidden",b="none",T="block",X="nowrap",N="rgba(0, 0, 0, 0.005)";p.setImage("node_dragger","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAN9JREFUeNrsV9sNhDAMKyzQVdgARmGzrMJNUFZhAh6nfkVcG9PQgHSR8lEksJs6pnGuLCimSRzAa0yyBK9O4gy8GokU+O0kJOAwiQYg0LP1xNYDW3+0CfBYNb7VOuN4LAGpiOaYUhFDas9F2NPHDELNENJqaHgBgSQJ3ufakfQJqckERcOiK+Ae1FGWBNKGh9oX5WPpLpdNYfffijbsxTHh7VKP7388n1g1h7OKUoUuyGpJakQEuhwkZAKcDXVOdWcrOrL/feBVBHI/q8fcjE1nA9PpyHQ+NJ2Qi8A3AQYAOtS27fCoRY0AAAAASUVORK5CYII=");var M=A.graph.GraphView.prototype,i=M._42;M.adjustHtmlNodeIndex=!0,M._42=function(f,_){if(i.call(this,f,_),this.adjustHtmlNodeIndex)for(var d=this.getDataModel()._datas._as,J=d.length,k=1,V=0;J>V;V++){var N=d[V];if(N instanceof H){var o=this.getDataUI(N);z(o.$2f,$,k+""),z(o.$3f,$,k+1+""),k+=2}}};var k=A.HtmlNodeUI=function(y,s){var $=this;k.superClass.constructor.call($,y,s);var H=$.$2f=n(),q=$.$3f=S();z(H,w,l),z(H,I,v),z(H,x,X),q.draggable=!1,z(q,w,l),z(q,K,b),D(q,Y),W(H,"change",function(V){var v=V.target,R=v.bind||v.getAttribute("bind"),L=v.type&&"checkbox"===v.type?v.checked:v.value,B=s.getContext();R&&B&&(B[R]=L,$.$4f=JSON.stringify(B))}),["mousedown","touchstart","keydown","mousewheel","DOMMouseScroll"].forEach(function(F){W(H,F,this.$9f.bind(this))},$)};p.def(k,g.ui().NodeUI,{_visible:!0,$11f:function(){var f=this,n=f.$3f,D=f._data,d=D.getDraggerImageWidth(),N=D.getDraggerImageHeight(),z=D.getDraggerImage(),G=g.initContext(n);G.beginPath(),g.setCanvas(n,d,N),g.translateAndScale(G,0,0,1),G.clearRect(0,0,d,N),p.drawImage(G,p.getImage(z),0,0,d,N),G.restore()},_80o:function(j){k.superClass._80o.call(this,j);var e=this,f=e._data,x=f._padding,A=2*x,Q=e.$2f,O=e.$3f,g=e.gv,W=g.getZoom(),h=g.getTranslateX(),B=g.getTranslateY(),V=g.getView(),S=e._83o,M=f._width,C=f._height,i=S.position,H=S.rotation,J=(M-A)/f.$5f*W,E=(C-A)/f.$6f*W,_=e._html,D=f._html,L=f.getHtmlType();if("html"===L){var Y=f.getContext()||{},X=e.$4f,q=f.$10f,o=JSON.stringify(Y);_&&X&&_===D&&X===o||(e.$4f=o,e._html=D,Q.innerHTML=q?q(Y):D)}else if(null!=L){var d=f.getHtml();"ht"===L&&(d=d.getView()),_&&_===d&&Q.contains(_)||(e._html=d,Q.innerHTML="",y(Q,d))}if(!Q.parentNode){var G=g.$1f;if(!G){var p=n();z(p,w,l),z(p,$,"0"),G=g.$1f=p;var a=g._canvas.nextSibling;a?V.insertBefore(p,a):y(V,p)}y(G,Q),y(G,O),f.onContentInitialized&&f.onContentInitialized(Q)}if(f._scalable){var R=f.$5f,m=f.$6f;c(Q,"rotate("+180*(H/u)+"deg) scale("+J+","+E+")"),z(Q,t,""),z(Q,s,""),z(Q,r,(i.x-R/W/2)*W+h+Z),z(Q,P,(i.y-m/W/2)*W+B+Z)}else{var bg=U(Q.style.width),os=U(Q.style.height),Vd=U((M-A)*W),_p=U((C-A)*W),jg="100%",ac=Q.children[0];z(ac,t,jg),z(ac,s,jg),(bg!==Vd||os!==_p)&&(z(Q,t,Vd+Z),z(Q,s,_p+Z),"ht"===L&&D.invalidate()),c(Q,"rotate("+180*(H/u)+"deg)"),z(Q,r,(i.x-Vd/W/2)*W+h+Z),z(Q,P,(i.y-_p/W/2)*W+B+Z)}var Td=e.dragRect;g.isMovable(f)&&g.isSelected(f)&&Td?(j.save(),j.fillStyle=N,j.fillRect(Td.x,Td.y,Td.width,Td.height),j.restore(),z(O,r,Td.x*W+h+Z),z(O,P,Td.y*W+B+Z),c(O,"scale("+W+","+W+")"),z(O,K,T),e.$11f()):z(O,K,b),z(Q,I,this._visible?F:v)},dispose:function(){var N=this.gv.$1f;this.$2f.parentNode===N&&N.removeChild(this.$2f),this.$3f.parentNode===N&&N.removeChild(this.$3f)},_84o:function(V){this._visible=V,z(this.$2f,I,V?F:v),z(this.$3f,K,V?T:b)},_3O:function(){var M=this,f=M.gv,O=M._data;k.superClass._3O.call(M);var p=O.getRect();f.isEditable(O)&&(M.dragRect={x:p.x+p.width+O._padding,y:p.y+10,width:O.getDraggerImageWidth(),height:O.getDraggerImageHeight()},M._68o(M.dragRect))},rectIntersects:function(o){var T=this._79o();return A.Default.intersection(T,o)?!0:void 0},$9f:function(v){var M=this.gv,Z=this._data;M.sm().contains(Z)&&v.stopPropagation()}});var H=A.HtmlNode=function(){H.superClass.constructor.call(this)};A.Default.def(H,A.Node,{ms_ac:["html","context","scalable","padding","draggerImage","draggerImageWidth","draggerImageHeight"],_padding:A.Default.isTouchable?12:6,_image:null,_scalable:!0,_draggerImage:"node_dragger",_draggerImageWidth:20,_draggerImageHeight:20,setHtml:function(k){var v=this,E=v._html;v._html=k,"html"===v.getHtmlType()&&"Handlebars"in m&&(v.$10f=Handlebars.compile(k)),v.$13f(),v.fp("html",E,k)},setContext:function(q){var N=this,a=N._context;N._context=q,N.fp("context",a,q),N.$13f()},setScalable:function(b){var e=this,i=e._scalable;e._scalable=b,e.fp("scalable",i,b),e.$13f()},getHtmlType:function(){var v=this._html;return v?"string"==typeof v?"html":v.getView?"ht":"dom":null},$13f:function(){var r=this,R=r._html,k=r.$10f;if(R){var _=n(),j=!1,o=r.getHtmlType();if(z(_,w,l),z(_,x,X),z(_,I,v),"html"===o?(_.innerHTML=k?k(r.getContext()||{}):R,j=!0):"ht"===o?(y(_,R.getView()),j=!0):"dom"===o&&(y(_,R),j=!0),j){var E=2*r._padding;y(e(),_),r.$5f=_.scrollWidth,r.$6f=_.scrollHeight,r._width=r.$5f+E,r._height=r.$6f+E,r._originWidth=r._width,r._originHeight=r._height,Q(e(),_)}}},getUIClass:function(){return A.HtmlNodeUI}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);